--==========================================================================================
-- IPM
--==========================================================================================

CREATE SEQUENCE public.device_id_seq;


-- INSIGHT_INFO
CREATE TABLE public.device_collector
(
  device_id integer NOT NULL DEFAULT nextval('device_id_seq'::regclass),
  site_id integer NOT NULL,
  host character varying(128),
  model_name character varying(64),
  ipv4 character varying(16) DEFAULT '',
  ipv6 character varying(40) DEFAULT '',
  enable_control_ipv4 boolean DEFAULT false,
  enable_control_ipv6 boolean DEFAULT true,
  enable_collect_cam boolean DEFAULT true,
  enable_recv_syslog boolean DEFAULT true,
  CONSTRAINT ipm_insight_info_pkey PRIMARY KEY (insight_id)
);

CREATE TABLE public.device_dhcp
(
  device_id integer NOT NULL DEFAULT nextval('device_id_seq'::regclass),
  site_id integer NOT NULL,
  host character varying(128),
  ipv4 character varying(16) DEFAULT '',
  ipv6 character varying(40) DEFAULT '',
  device_name character varying(128),
  device_type character varying(32) NOT NULL,
  snmp_community character varying(64) DEFAULT '',
  snmp_version integer DEFAULT 2,
  vendor character varying(64),
  model character varying(128),
  service_type integer,
  sys_oid character varying(256),
  sys_location character varying(256),
  api_type character varying(64),
  api_version character varying(64),
  api_userid character varying(64),
  api_password character varying(256),
  description character varying(512),
  insert_time timestamp with time zone DEFAULT current_timestamp,
  update_time timestamp with time zone DEFAULT current_timestamp,
  CONSTRAINT device_info_pkey PRIMARY KEY (device_id),
  CONSTRAINT device_ip_unique UNIQUE (ipv4, ipv6)
);


--==========================================================================================
-- SITE
--==========================================================================================

-- SITE_INFO
CREATE SEQUENCE public.site_info_id_seq;
CREATE TABLE public.site_info
(
  site_id integer NOT NULL DEFAULT nextval('site_info_id_seq'::regclass),
  site_name character varying(128) NOT NULL,
  site_code character varying(8) NOT NULL,
  description character varying(512),
  CONSTRAINT site_info_pkey PRIMARY KEY (site_id)
);

CREATE SEQUENCE public.site_blacklist_id_seq;
CREATE TABLE public.site_blacklist_info
(
  blacklist_id integer NOT NULL DEFAULT nextval('site_blacklist_id_seq'::regclass),
  site_id integer NOT NULL,
  blacklist_enable boolean DEFAULT false,
  blacklist_filter_name character varying(128) DEFAULT '',
  blacklist_time_sec integer DEFAULT 30,
  description character varying(512),
  insert_time timestamp with time zone DEFAULT current_timestamp,
  update_time timestamp with time zone DEFAULT current_timestamp,
  CONSTRAINT site_blacklist_info_pkey PRIMARY KEY (blacklist_id)
);


-- SEGMENT_INFO
CREATE SEQUENCE public.site_segment_id_seq;
CREATE TABLE public.site_segment_info
(
  segment_id integer NOT NULL DEFAULT nextval('site_segment_id_seq'::regclass),
  site_id integer NOT NULL,
  network character varying(40) NOT NULL,
  start_ip bigint,
  end_ip bigint,
  ip_count integer,
  CONSTRAINT site_segment_info_pkey PRIMARY KEY (segment_id),
  CONSTRAINT site_segment_network_unique UNIQUE (network)
)

--==========================================================================================
-- DEVICE
--==========================================================================================
CREATE TABLE public.device_info
(
  device_id integer NOT NULL DEFAULT nextval('device_id_seq'::regclass),
  site_id integer NOT NULL,
  ipv4 character varying(16) DEFAULT '',
  ipv6 character varying(40) DEFAULT '',
  device_name character varying(128),
  device_type character varying(32) NOT NULL,
  snmp_community character varying(64) DEFAULT '',
  snmp_version integer DEFAULT 2,
  vendor character varying(64),
  model character varying(128),
  service_type integer,
  sys_oid character varying(256),
  sys_location character varying(256),
  api_type character varying(64),
  api_version character varying(64),
  api_userid character varying(64),
  api_password character varying(256),
  description character varying(512),
  insert_time timestamp with time zone DEFAULT current_timestamp,
  update_time timestamp with time zone DEFAULT current_timestamp,
  CONSTRAINT device_info_pkey PRIMARY KEY (device_id),
  CONSTRAINT device_ip_unique UNIQUE (ipv4, ipv6)
);
COMMENT ON COLUMN public.device_info.api_type IS 'WAPI, TELNET, ...';
COMMENT ON COLUMN public.device_info.device_type IS 'DHCP, SWITCH, FIREWALL, ...';



CREATE TABLE public.device_interface
(
  device_id integer NOT NULL,
  if_number integer NOT NULL,
  if_name character varying(128),
  if_desc character varying(256),
  if_speed integer NOT NULL,
  if_macaddr character varying(20),
  if_alias character varying(128),
  admin_stauts integer DEFAULT 0,
  oper_stauts integer DEFAULT 0,
  user_desc character varying(256),
  last_used_octect float,
  last_used_time timestamp with time zone,
  insert_time timestamp with time zone DEFAULT current_timestamp,
  update_time timestamp with time zone DEFAULT current_timestamp,
  CONSTRAINT device_interface_pkey PRIMARY KEY (device_id, if_number)
);
COMMENT ON COLUMN public.device_interface.if_speed IS 'Mbps';


CREATE TABLE public.device_interface_ip
(
  device_id integer NOT NULL,
  if_number integer NOT NULL,
  if_ipaddr character varying(16),
  network_ip character varying(16),
  network_mask character varying(16),
  insert_time timestamp with time zone DEFAULT current_timestamp,
  update_time timestamp with time zone DEFAULT current_timestamp,
  CONSTRAINT device_interface_ip_pkey PRIMARY KEY (device_id, if_number, if_ipaddr)
);



--==========================================================================================
-- EVENT
--==========================================================================================

CREATE SEQUENCE public.event_id_seq;

-- EVENT_LOG
CREATE TABLE public.event_log
(
  event_id integer NOT NULL DEFAULT nextval('event_id_seq'::regclass),
  device_id integer,
  host_ip character varying(16),
  event_type character varying(32) NOT NULL,
  severity integer NOT NULL,
  collect_time timestamp with time zone DEFAULT current_timestamp,
  message character varying(512) NOT NULL,
  CONSTRAINT event_id_pkey PRIMARY KEY (event_id)
);
COMMENT ON COLUMN public.event_log.event_type IS 'syslog, ...';

CREATE INDEX event_log_idx ON public.event_log USING btree (device_id, collect_time);


--==========================================================================================
-- AUTH
--==========================================================================================

-- AUTH_TYPE
CREATE TABLE public.auth_type
(
  auth_type_id integer NOT NULL,
  auth_name character varying(64) NOT NULL,
  auth_type character varying(32) NOT NULL,
  CONSTRAINT auth_type_id_pkey PRIMARY KEY (auth_type_id)
);

-- AUTH_ORDER
CREATE TABLE public.auth_order
(
  site_id integer NOT NULL,
  sequence_type character varying(32) DEFAULT 'sequence',
  auth_type_id integer NOT NULL,
  auth_order integer NOT NULL,
  CONSTRAINT auth_order_id_pkey PRIMARY KEY (site_id, auth_type_id, auth_order)
);


-- AUTH_LDAP_GROUP
CREATE SEQUENCE public.auth_ldap_group_id_seq;
CREATE TABLE public.auth_ldap_group
(
  ldap_group_id integer NOT NULL DEFAULT nextval('auth_ldap_group_id_seq'::regclass),
  auth_type_id integer DEFAULT 1,
  domain_name character varying(512) NOT NULL,
  group_name character varying(512) NOT NULL,
  group_type character varying(64) NOT NULL,
  CONSTRAINT ldap_group_id_pkey PRIMARY KEY (ldap_group_id)
);

-- AUTH_SETUP_ID Sequence
CREATE SEQUENCE public.auth_setup_id_seq;

-- AUTH_SETUP_LDAP
CREATE TABLE public.auth_setup_ldap
(
  setup_id integer NOT NULL DEFAULT nextval('auth_setup_id_seq'::regclass),
  site_id integer NOT NULL,
  host character varying(64) NOT NULL,
  port integer NOT NULL,
  ssl_enable boolean NOT NULL DEFAULT false,
  
  auth_type character varying(32) NOT NULL,
  bind_domain character varying(128) NOT NULL,
  bind_passwd character varying(64) NOT NULL,
  base_domain character varying(128) NOT NULL,
  user_class character varying(128) NOT NULL,
  user_attr character varying(128) NOT NULL,
  user_name_attr character varying(128) NOT NULL,
  user_memberof_attr character varying(128) NOT NULL,
  
  group_class character varying(128) NOT NULL,
  group_name_attr character varying(128) NOT NULL,
  group_member_attr character varying(128) NOT NULL,
  
  kerberos_enable boolean NOT NULL DEFAULT false,
  kerberos_host character varying(64),
  kerberos_port integer,
  kerberos_realm character varying(128),
  
  CONSTRAINT auth_setup_ldap_id_pkey PRIMARY KEY (setup_id)
);

-- AUTH_SETUP_ESB
CREATE TABLE public.auth_setup_esb
(
  setup_id integer NOT NULL DEFAULT nextval('auth_setup_id_seq'::regclass),
  site_id integer NOT NULL,
  url character varying(256) NOT NULL,
  user_id character varying(64) NOT NULL,
  user_passwd character varying(64) NOT NULL,
  
  CONSTRAINT auth_setup_esb_id_pkey PRIMARY KEY (setup_id)
);

-- AUTH_SETUP_RADIUS
CREATE TABLE public.auth_setup_radius
(
  setup_id integer NOT NULL DEFAULT nextval('auth_setup_id_seq'::regclass),
  site_id integer NOT NULL,
  host character varying(64) NOT NULL,
  password character varying(128) NOT NULL,
  auth_port integer NOT NULL,
  acct_port integer NOT NULL,
  timeout_sec integer DEFAULT 3,
  nas_ip character varying(32) NOT NULL,
  nas_identifier character varying(64) NOT NULL,
  service_type character varying(64) DEFAULT 'Login-User',
  called_station_id character varying(64) NOT NULL,
  
  CONSTRAINT auth_setup_radius_id_pkey PRIMARY KEY (setup_id)
);


--==========================================================================================
-- DHCP
--==========================================================================================

-- DHCP_MAC_FILTER
CREATE SEQUENCE dhcp_mac_filter_id_seq;
CREATE TABLE public.dhcp_mac_filter
(
  filter_id integer NOT NULL DEFAULT nextval('dhcp_mac_filter_id_seq'::regclass),
  site_id integer NOT NULL,
  filter_name character varying(128) NOT NULL,
  filter_desc character varying(512),
  CONSTRAINT dhcp_mac_filter_pkey PRIMARY KEY (filter_id)
);

-- DHCP_NETWORK
CREATE SEQUENCE public.dhcp_network_id_seq;
CREATE TABLE public.dhcp_network
(
  dhcp_network_id integer NOT NULL DEFAULT nextval('dhcp_network_id_seq'::regclass),
  site_id integer NOT NULL,
  network character varying(32) NOT NULL,
  start_ip character varying(16) NOT NULL,
  end_ip character varying(16) NOT NULL,
  
  filter_name character varying(128),
  CONSTRAINT dhcp_network_id_pkey PRIMARY KEY (dhcp_network_id)
);
