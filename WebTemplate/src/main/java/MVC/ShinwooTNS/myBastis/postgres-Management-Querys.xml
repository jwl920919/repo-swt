<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="UI_Query">
	<!-- Query Type : Select(Select, Insert, Update, Delete) -->
	<!-- Insert Date : 2016-08-11 -->
	<!-- Insert User : 이재원 -->
	<!-- Description : Client Node Information Search -->
	<!-- Controller :  -->
	<select id="select_CLIENT_NODE_INFO_SEARCH" parameterType="hashmap" resultType="java.util.HashMap">
		SELECT ci.*, si.site_name 
		FROM 
			(
				SELECT 
				vci.*,vis.site_id,vis.network,vis.ip_num,vis.is_range,vis.ip_status,vis.lease_start_time,vis.lease_end_time 
				FROM view_client_info AS vci left join view_ip_status AS vis 
				ON vci.macaddr = vis.macaddr
			) 
		AS ci left join site_info AS si 
		ON ci.site_id = si.site_id
		<!-- where ci.lease_end_time > NOW() - INTERVAL '30 days' -->
	</select>
	
	<!-- Query Type : Select(Select, Insert, Update, Delete) -->
	<!-- Insert Date : 2016-08-12 -->
	<!-- Insert User : 이재원 -->
	<!-- Description : Network Information Search -->
	<!-- Controller :  -->
	<select id="select_SEARCHED_NETWORK_INFO" resultType="java.util.HashMap">
		SELECT site_id,network,ip_type,update_time 
		FROM dhcp_network;
	</select>
	
	<!-- Query Type : Select(Select, Insert, Update, Delete) -->
	<!-- Insert Date : 2016-08-16 -->
	<!-- Insert User : 이재원 -->
	<!-- Description : Network Information 행 개수 조회 -->
	<!-- Controller : MVC.ShinwooTNS.action.ConfigManagementActionController -->
	<select id="select_SEARCHED_NETWORK_INFO_TOTAL_COUNT" resultType="Integer">
		SELECT count(*) AS total
		FROM dhcp_network
	</select>

	<!-- Query Type : Select(Select, Insert, Update, Delete) -->
	<!-- Insert Date : 2016-08-16 -->
	<!-- Insert User : 이재원 -->
	<!-- Description : custom group information Search -->
	<!-- Controller : MVC.ShinwooTNS.action.ManagementActionController-->
	<select id="select_CUSTOM_GROUP_INFO" parameterType="hashmap" resultType="java.util.HashMap">
		SELECT cg.group_id,COALESCE(cg.group_name,'') AS
		group_name, dn."network" AS key,
		COALESCE(cg."type",'N') AS "type",dn.site_id,dn.ip_type
		FROM dhcp_network AS dn LEFT JOIN custom_group AS cg
		ON dn."network" = cg.key and cg."type" = 'N'
		WHERE (dn."network" like CONCAT('%', #{searchValue}, '%') 
			OR cg.group_name like CONCAT('%', #{searchValue}, '%'))
			AND dn.ip_type=#{ip_type}
		ORDER BY ${orderColumn} ${orderType} OFFSET #{startIndex} LIMIT #{length}
	</select>

	<!-- Query Type : Select(Select, Insert, Update, Delete) -->
	<!-- Insert Date : 2016-08-16 -->
	<!-- Insert User : 이재원 -->
	<!-- Description : Network Information 행 개수 조회 -->
	<!-- Controller : MVC.ShinwooTNS.action.ManagementActionController -->
	<select id="select_CUSTOM_GROUP_INFO_TOTAL_COUNT" parameterType="hashmap" resultType="Integer">
		SELECT count(*) AS total
		FROM dhcp_network AS dn LEFT JOIN custom_group AS cg 
		ON dn."network" = cg.key and cg."type" = 'N'
		WHERE (dn."network" like CONCAT('%', #{searchValue}, '%') 
			OR cg.group_name like CONCAT('%', #{searchValue}, '%'))
			AND dn.ip_type=#{ip_type}
	</select>

	<!-- Query Type : Update(Select, Insert, Update, Delete) -->
	<!-- Insert Date : 2016-08-16 -->
	<!-- Insert User : 이재원 -->
	<!-- Description : Network Information Record Modify -->
	<!-- Controller : MVC.ShinwooTNS.action.ManagementActionController -->
	<update id="update_CUSTOM_GROUP_INFO" parameterType="hashmap">
		UPDATE custom_group 
		SET group_name=#{group_name} 
		WHERE group_id=#{group_id};
	</update>
	
	<!-- Query Type : Insert(Select, Insert, Update, Delete) -->
	<!-- Insert Date : 2016-08-16 -->
	<!-- Insert User : 이재원 -->
	<!-- Description : Network Information Record Modify -->
	<!-- Controller : MVC.ShinwooTNS.action.ManagementActionController -->
	<insert id="insert_CUSTOM_GROUP_INFO" parameterType="hashmap">
		INSERT INTO custom_group ("key", "group_name", "type") 
		VALUES (#{network}, #{group_name}, 'N');
	</insert>
</mapper>

